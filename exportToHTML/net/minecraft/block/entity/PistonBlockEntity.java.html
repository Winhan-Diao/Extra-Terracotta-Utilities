<html>
<head>
<title>PistonBlockEntity.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #f92673; font-weight: bold;}
.s1 { color: #a9b7c6;}
.s2 { color: #a9b7c6;}
.s3 { color: #629755; font-style: italic;}
.s4 { color: #ae81ff;}
.s5 { color: #e6db74;}
</style>
</head>
<body bgcolor="#2c2c2c">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
PistonBlockEntity.java</font>
</center></td></tr></table>
<pre><span class="s0">package </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">block</span><span class="s2">.</span><span class="s1">entity</span><span class="s2">;</span>

<span class="s0">import </span><span class="s1">java</span><span class="s2">.</span><span class="s1">util</span><span class="s2">.</span><span class="s1">Iterator</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">java</span><span class="s2">.</span><span class="s1">util</span><span class="s2">.</span><span class="s1">List</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">block</span><span class="s2">.</span><span class="s1">Block</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">block</span><span class="s2">.</span><span class="s1">BlockState</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">block</span><span class="s2">.</span><span class="s1">Blocks</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">block</span><span class="s2">.</span><span class="s1">PistonBlock</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">block</span><span class="s2">.</span><span class="s1">PistonHeadBlock</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">block</span><span class="s2">.</span><span class="s1">enums</span><span class="s2">.</span><span class="s1">PistonType</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">block</span><span class="s2">.</span><span class="s1">piston</span><span class="s2">.</span><span class="s1">PistonBehavior</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">entity</span><span class="s2">.</span><span class="s1">Entity</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">entity</span><span class="s2">.</span><span class="s1">MovementType</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">nbt</span><span class="s2">.</span><span class="s1">NbtCompound</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">nbt</span><span class="s2">.</span><span class="s1">NbtHelper</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">registry</span><span class="s2">.</span><span class="s1">Registries</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">registry</span><span class="s2">.</span><span class="s1">RegistryEntryLookup</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">registry</span><span class="s2">.</span><span class="s1">RegistryKeys</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">server</span><span class="s2">.</span><span class="s1">network</span><span class="s2">.</span><span class="s1">ServerPlayerEntity</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">state</span><span class="s2">.</span><span class="s1">property</span><span class="s2">.</span><span class="s1">Properties</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">util</span><span class="s2">.</span><span class="s1">math</span><span class="s2">.</span><span class="s1">BlockPos</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">util</span><span class="s2">.</span><span class="s1">math</span><span class="s2">.</span><span class="s1">Box</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">util</span><span class="s2">.</span><span class="s1">math</span><span class="s2">.</span><span class="s1">Boxes</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">util</span><span class="s2">.</span><span class="s1">math</span><span class="s2">.</span><span class="s1">Direction</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">util</span><span class="s2">.</span><span class="s1">math</span><span class="s2">.</span><span class="s1">MathHelper</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">util</span><span class="s2">.</span><span class="s1">math</span><span class="s2">.</span><span class="s1">Vec3d</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">util</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">.</span><span class="s1">VoxelShape</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">util</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">.</span><span class="s1">VoxelShapes</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">world</span><span class="s2">.</span><span class="s1">BlockView</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">net</span><span class="s2">.</span><span class="s1">minecraft</span><span class="s2">.</span><span class="s1">world</span><span class="s2">.</span><span class="s1">World</span><span class="s2">;</span>

<span class="s3">/**</span>
 <span class="s3">* A piston block entity represents the block being pushed by a piston.</span>
 <span class="s3">*/</span>
<span class="s0">public class </span><span class="s1">PistonBlockEntity </span><span class="s0">extends </span><span class="s1">BlockEntity </span><span class="s2">{</span>
	<span class="s0">private static final int </span><span class="s1">field_31382 </span><span class="s2">= </span><span class="s4">2</span><span class="s2">;</span>
	<span class="s0">private static final double </span><span class="s1">field_31383 </span><span class="s2">= </span><span class="s4">0.01</span><span class="s2">;</span>
	<span class="s0">public static final double </span><span class="s1">field_31381 </span><span class="s2">= </span><span class="s4">0.51</span><span class="s2">;</span>
	<span class="s0">private </span><span class="s1">BlockState pushedBlock</span><span class="s2">;</span>
	<span class="s0">private </span><span class="s1">Direction facing</span><span class="s2">;</span>
	<span class="s0">private boolean </span><span class="s1">extending</span><span class="s2">;</span>
	<span class="s0">private boolean </span><span class="s1">source</span><span class="s2">;</span>
	<span class="s0">private static final </span><span class="s1">ThreadLocal</span><span class="s2">&lt;</span><span class="s1">Direction</span><span class="s2">&gt; </span><span class="s1">entityMovementDirection </span><span class="s2">= </span><span class="s1">ThreadLocal</span><span class="s2">.</span><span class="s1">withInitial</span><span class="s2">(() </span><span class="s1">-&gt; </span><span class="s2">{</span>
		<span class="s0">return null</span><span class="s2">;</span>
	<span class="s2">});</span>
	<span class="s0">private float </span><span class="s1">progress</span><span class="s2">;</span>
	<span class="s0">private float </span><span class="s1">lastProgress</span><span class="s2">;</span>
	<span class="s0">private long </span><span class="s1">savedWorldTime</span><span class="s2">;</span>
	<span class="s0">private int </span><span class="s1">field_26705</span><span class="s2">;</span>

	<span class="s0">public </span><span class="s1">PistonBlockEntity</span><span class="s2">(</span><span class="s1">BlockPos pos</span><span class="s2">, </span><span class="s1">BlockState state</span><span class="s2">) {</span>
		<span class="s0">super</span><span class="s2">(</span><span class="s1">BlockEntityType</span><span class="s2">.</span><span class="s1">PISTON</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">state</span><span class="s2">);</span>
		<span class="s0">this</span><span class="s2">.</span><span class="s1">pushedBlock </span><span class="s2">= </span><span class="s1">Blocks</span><span class="s2">.</span><span class="s1">AIR</span><span class="s2">.</span><span class="s1">getDefaultState</span><span class="s2">();</span>
	<span class="s2">}</span>

	<span class="s0">public </span><span class="s1">PistonBlockEntity</span><span class="s2">(</span><span class="s1">BlockPos pos</span><span class="s2">, </span><span class="s1">BlockState state</span><span class="s2">, </span><span class="s1">BlockState pushedBlock</span><span class="s2">, </span><span class="s1">Direction facing</span><span class="s2">, </span><span class="s0">boolean </span><span class="s1">extending</span><span class="s2">, </span><span class="s0">boolean </span><span class="s1">source</span><span class="s2">) {</span>
		<span class="s0">this</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">, </span><span class="s1">state</span><span class="s2">);</span>
		<span class="s0">this</span><span class="s2">.</span><span class="s1">pushedBlock </span><span class="s2">= </span><span class="s1">pushedBlock</span><span class="s2">;</span>
		<span class="s0">this</span><span class="s2">.</span><span class="s1">facing </span><span class="s2">= </span><span class="s1">facing</span><span class="s2">;</span>
		<span class="s0">this</span><span class="s2">.</span><span class="s1">extending </span><span class="s2">= </span><span class="s1">extending</span><span class="s2">;</span>
		<span class="s0">this</span><span class="s2">.</span><span class="s1">source </span><span class="s2">= </span><span class="s1">source</span><span class="s2">;</span>
	<span class="s2">}</span>

	<span class="s0">public </span><span class="s1">NbtCompound toInitialChunkDataNbt</span><span class="s2">() {</span>
		<span class="s0">return this</span><span class="s2">.</span><span class="s1">createNbt</span><span class="s2">();</span>
	<span class="s2">}</span>

	<span class="s0">public boolean </span><span class="s1">isExtending</span><span class="s2">() {</span>
		<span class="s0">return this</span><span class="s2">.</span><span class="s1">extending</span><span class="s2">;</span>
	<span class="s2">}</span>

	<span class="s0">public </span><span class="s1">Direction getFacing</span><span class="s2">() {</span>
		<span class="s0">return this</span><span class="s2">.</span><span class="s1">facing</span><span class="s2">;</span>
	<span class="s2">}</span>

	<span class="s0">public boolean </span><span class="s1">isSource</span><span class="s2">() {</span>
		<span class="s0">return this</span><span class="s2">.</span><span class="s1">source</span><span class="s2">;</span>
	<span class="s2">}</span>

	<span class="s0">public float </span><span class="s1">getProgress</span><span class="s2">(</span><span class="s0">float </span><span class="s1">tickDelta</span><span class="s2">) {</span>
		<span class="s0">if </span><span class="s2">(</span><span class="s1">tickDelta </span><span class="s2">&gt; </span><span class="s4">1.0F</span><span class="s2">) {</span>
			<span class="s1">tickDelta </span><span class="s2">= </span><span class="s4">1.0F</span><span class="s2">;</span>
		<span class="s2">}</span>

		<span class="s0">return </span><span class="s1">MathHelper</span><span class="s2">.</span><span class="s1">lerp</span><span class="s2">(</span><span class="s1">tickDelta</span><span class="s2">, </span><span class="s0">this</span><span class="s2">.</span><span class="s1">lastProgress</span><span class="s2">, </span><span class="s0">this</span><span class="s2">.</span><span class="s1">progress</span><span class="s2">);</span>
	<span class="s2">}</span>

	<span class="s0">public float </span><span class="s1">getRenderOffsetX</span><span class="s2">(</span><span class="s0">float </span><span class="s1">tickDelta</span><span class="s2">) {</span>
		<span class="s0">return </span><span class="s2">(</span><span class="s0">float</span><span class="s2">)</span><span class="s0">this</span><span class="s2">.</span><span class="s1">facing</span><span class="s2">.</span><span class="s1">getOffsetX</span><span class="s2">() * </span><span class="s0">this</span><span class="s2">.</span><span class="s1">getAmountExtended</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">getProgress</span><span class="s2">(</span><span class="s1">tickDelta</span><span class="s2">));</span>
	<span class="s2">}</span>

	<span class="s0">public float </span><span class="s1">getRenderOffsetY</span><span class="s2">(</span><span class="s0">float </span><span class="s1">tickDelta</span><span class="s2">) {</span>
		<span class="s0">return </span><span class="s2">(</span><span class="s0">float</span><span class="s2">)</span><span class="s0">this</span><span class="s2">.</span><span class="s1">facing</span><span class="s2">.</span><span class="s1">getOffsetY</span><span class="s2">() * </span><span class="s0">this</span><span class="s2">.</span><span class="s1">getAmountExtended</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">getProgress</span><span class="s2">(</span><span class="s1">tickDelta</span><span class="s2">));</span>
	<span class="s2">}</span>

	<span class="s0">public float </span><span class="s1">getRenderOffsetZ</span><span class="s2">(</span><span class="s0">float </span><span class="s1">tickDelta</span><span class="s2">) {</span>
		<span class="s0">return </span><span class="s2">(</span><span class="s0">float</span><span class="s2">)</span><span class="s0">this</span><span class="s2">.</span><span class="s1">facing</span><span class="s2">.</span><span class="s1">getOffsetZ</span><span class="s2">() * </span><span class="s0">this</span><span class="s2">.</span><span class="s1">getAmountExtended</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">getProgress</span><span class="s2">(</span><span class="s1">tickDelta</span><span class="s2">));</span>
	<span class="s2">}</span>

	<span class="s0">private float </span><span class="s1">getAmountExtended</span><span class="s2">(</span><span class="s0">float </span><span class="s1">progress</span><span class="s2">) {</span>
		<span class="s0">return this</span><span class="s2">.</span><span class="s1">extending </span><span class="s2">? </span><span class="s1">progress </span><span class="s2">- </span><span class="s4">1.0F </span><span class="s2">: </span><span class="s4">1.0F </span><span class="s2">- </span><span class="s1">progress</span><span class="s2">;</span>
	<span class="s2">}</span>

	<span class="s0">private </span><span class="s1">BlockState getHeadBlockState</span><span class="s2">() {</span>
		<span class="s0">return </span><span class="s2">!</span><span class="s0">this</span><span class="s2">.</span><span class="s1">isExtending</span><span class="s2">() &amp;&amp; </span><span class="s0">this</span><span class="s2">.</span><span class="s1">isSource</span><span class="s2">() &amp;&amp; </span><span class="s0">this</span><span class="s2">.</span><span class="s1">pushedBlock</span><span class="s2">.</span><span class="s1">getBlock</span><span class="s2">() </span><span class="s0">instanceof </span><span class="s1">PistonBlock </span><span class="s2">? (</span><span class="s1">BlockState</span><span class="s2">)((</span><span class="s1">BlockState</span><span class="s2">)((</span><span class="s1">BlockState</span><span class="s2">)</span><span class="s1">Blocks</span><span class="s2">.</span><span class="s1">PISTON_HEAD</span><span class="s2">.</span><span class="s1">getDefaultState</span><span class="s2">().</span><span class="s1">with</span><span class="s2">(</span><span class="s1">PistonHeadBlock</span><span class="s2">.</span><span class="s1">SHORT</span><span class="s2">, </span><span class="s0">this</span><span class="s2">.</span><span class="s1">progress </span><span class="s2">&gt; </span><span class="s4">0.25F</span><span class="s2">)).</span><span class="s1">with</span><span class="s2">(</span><span class="s1">PistonHeadBlock</span><span class="s2">.</span><span class="s1">TYPE</span><span class="s2">, </span><span class="s0">this</span><span class="s2">.</span><span class="s1">pushedBlock</span><span class="s2">.</span><span class="s1">isOf</span><span class="s2">(</span><span class="s1">Blocks</span><span class="s2">.</span><span class="s1">STICKY_PISTON</span><span class="s2">) ? </span><span class="s1">PistonType</span><span class="s2">.</span><span class="s1">STICKY </span><span class="s2">: </span><span class="s1">PistonType</span><span class="s2">.</span><span class="s1">DEFAULT</span><span class="s2">)).</span><span class="s1">with</span><span class="s2">(</span><span class="s1">PistonHeadBlock</span><span class="s2">.</span><span class="s1">FACING</span><span class="s2">, (</span><span class="s1">Direction</span><span class="s2">)</span><span class="s0">this</span><span class="s2">.</span><span class="s1">pushedBlock</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">PistonBlock</span><span class="s2">.</span><span class="s1">FACING</span><span class="s2">)) : </span><span class="s0">this</span><span class="s2">.</span><span class="s1">pushedBlock</span><span class="s2">;</span>
	<span class="s2">}</span>

	<span class="s0">private static void </span><span class="s1">pushEntities</span><span class="s2">(</span><span class="s1">World world</span><span class="s2">, </span><span class="s1">BlockPos pos</span><span class="s2">, </span><span class="s0">float </span><span class="s1">f</span><span class="s2">, </span><span class="s1">PistonBlockEntity blockEntity</span><span class="s2">) {</span>
		<span class="s1">Direction direction </span><span class="s2">= </span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">getMovementDirection</span><span class="s2">();</span>
		<span class="s0">double </span><span class="s1">d </span><span class="s2">= (</span><span class="s0">double</span><span class="s2">)(</span><span class="s1">f </span><span class="s2">- </span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">progress</span><span class="s2">);</span>
		<span class="s1">VoxelShape voxelShape </span><span class="s2">= </span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">getHeadBlockState</span><span class="s2">().</span><span class="s1">getCollisionShape</span><span class="s2">(</span><span class="s1">world</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">);</span>
		<span class="s0">if </span><span class="s2">(!</span><span class="s1">voxelShape</span><span class="s2">.</span><span class="s1">isEmpty</span><span class="s2">()) {</span>
			<span class="s1">Box box </span><span class="s2">= </span><span class="s1">offsetHeadBox</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">, </span><span class="s1">voxelShape</span><span class="s2">.</span><span class="s1">getBoundingBox</span><span class="s2">(), </span><span class="s1">blockEntity</span><span class="s2">);</span>
			<span class="s1">List</span><span class="s2">&lt;</span><span class="s1">Entity</span><span class="s2">&gt; </span><span class="s1">list </span><span class="s2">= </span><span class="s1">world</span><span class="s2">.</span><span class="s1">getOtherEntities</span><span class="s2">((</span><span class="s1">Entity</span><span class="s2">)</span><span class="s0">null</span><span class="s2">, </span><span class="s1">Boxes</span><span class="s2">.</span><span class="s1">stretch</span><span class="s2">(</span><span class="s1">box</span><span class="s2">, </span><span class="s1">direction</span><span class="s2">, </span><span class="s1">d</span><span class="s2">).</span><span class="s1">union</span><span class="s2">(</span><span class="s1">box</span><span class="s2">));</span>
			<span class="s0">if </span><span class="s2">(!</span><span class="s1">list</span><span class="s2">.</span><span class="s1">isEmpty</span><span class="s2">()) {</span>
				<span class="s1">List</span><span class="s2">&lt;</span><span class="s1">Box</span><span class="s2">&gt; </span><span class="s1">list2 </span><span class="s2">= </span><span class="s1">voxelShape</span><span class="s2">.</span><span class="s1">getBoundingBoxes</span><span class="s2">();</span>
				<span class="s0">boolean </span><span class="s1">bl </span><span class="s2">= </span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">pushedBlock</span><span class="s2">.</span><span class="s1">isOf</span><span class="s2">(</span><span class="s1">Blocks</span><span class="s2">.</span><span class="s1">SLIME_BLOCK</span><span class="s2">);</span>
				<span class="s1">Iterator var12 </span><span class="s2">= </span><span class="s1">list</span><span class="s2">.</span><span class="s1">iterator</span><span class="s2">();</span>

				<span class="s0">while</span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
					<span class="s1">Entity entity</span><span class="s2">;</span>
					<span class="s0">while</span><span class="s2">(</span><span class="s0">true</span><span class="s2">) {</span>
						<span class="s0">do </span><span class="s2">{</span>
							<span class="s0">if </span><span class="s2">(!</span><span class="s1">var12</span><span class="s2">.</span><span class="s1">hasNext</span><span class="s2">()) {</span>
								<span class="s0">return</span><span class="s2">;</span>
							<span class="s2">}</span>

							<span class="s1">entity </span><span class="s2">= (</span><span class="s1">Entity</span><span class="s2">)</span><span class="s1">var12</span><span class="s2">.</span><span class="s1">next</span><span class="s2">();</span>
						<span class="s2">} </span><span class="s0">while</span><span class="s2">(</span><span class="s1">entity</span><span class="s2">.</span><span class="s1">getPistonBehavior</span><span class="s2">() == </span><span class="s1">PistonBehavior</span><span class="s2">.</span><span class="s1">IGNORE</span><span class="s2">);</span>

						<span class="s0">if </span><span class="s2">(!</span><span class="s1">bl</span><span class="s2">) {</span>
							<span class="s0">break</span><span class="s2">;</span>
						<span class="s2">}</span>

						<span class="s0">if </span><span class="s2">(!(</span><span class="s1">entity </span><span class="s0">instanceof </span><span class="s1">ServerPlayerEntity</span><span class="s2">)) {</span>
							<span class="s1">Vec3d vec3d </span><span class="s2">= </span><span class="s1">entity</span><span class="s2">.</span><span class="s1">getVelocity</span><span class="s2">();</span>
							<span class="s0">double </span><span class="s1">e </span><span class="s2">= </span><span class="s1">vec3d</span><span class="s2">.</span><span class="s1">x</span><span class="s2">;</span>
							<span class="s0">double </span><span class="s1">g </span><span class="s2">= </span><span class="s1">vec3d</span><span class="s2">.</span><span class="s1">y</span><span class="s2">;</span>
							<span class="s0">double </span><span class="s1">h </span><span class="s2">= </span><span class="s1">vec3d</span><span class="s2">.</span><span class="s1">z</span><span class="s2">;</span>
							<span class="s0">switch </span><span class="s2">(</span><span class="s1">direction</span><span class="s2">.</span><span class="s1">getAxis</span><span class="s2">()) {</span>
								<span class="s0">case </span><span class="s1">X</span><span class="s2">:</span>
									<span class="s1">e </span><span class="s2">= (</span><span class="s0">double</span><span class="s2">)</span><span class="s1">direction</span><span class="s2">.</span><span class="s1">getOffsetX</span><span class="s2">();</span>
									<span class="s0">break</span><span class="s2">;</span>
								<span class="s0">case </span><span class="s1">Y</span><span class="s2">:</span>
									<span class="s1">g </span><span class="s2">= (</span><span class="s0">double</span><span class="s2">)</span><span class="s1">direction</span><span class="s2">.</span><span class="s1">getOffsetY</span><span class="s2">();</span>
									<span class="s0">break</span><span class="s2">;</span>
								<span class="s0">case </span><span class="s1">Z</span><span class="s2">:</span>
									<span class="s1">h </span><span class="s2">= (</span><span class="s0">double</span><span class="s2">)</span><span class="s1">direction</span><span class="s2">.</span><span class="s1">getOffsetZ</span><span class="s2">();</span>
							<span class="s2">}</span>

							<span class="s1">entity</span><span class="s2">.</span><span class="s1">setVelocity</span><span class="s2">(</span><span class="s1">e</span><span class="s2">, </span><span class="s1">g</span><span class="s2">, </span><span class="s1">h</span><span class="s2">);</span>
							<span class="s0">break</span><span class="s2">;</span>
						<span class="s2">}</span>
					<span class="s2">}</span>

					<span class="s0">double </span><span class="s1">i </span><span class="s2">= </span><span class="s4">0.0</span><span class="s2">;</span>
					<span class="s1">Iterator var16 </span><span class="s2">= </span><span class="s1">list2</span><span class="s2">.</span><span class="s1">iterator</span><span class="s2">();</span>

					<span class="s0">while</span><span class="s2">(</span><span class="s1">var16</span><span class="s2">.</span><span class="s1">hasNext</span><span class="s2">()) {</span>
						<span class="s1">Box box2 </span><span class="s2">= (</span><span class="s1">Box</span><span class="s2">)</span><span class="s1">var16</span><span class="s2">.</span><span class="s1">next</span><span class="s2">();</span>
						<span class="s1">Box box3 </span><span class="s2">= </span><span class="s1">Boxes</span><span class="s2">.</span><span class="s1">stretch</span><span class="s2">(</span><span class="s1">offsetHeadBox</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">, </span><span class="s1">box2</span><span class="s2">, </span><span class="s1">blockEntity</span><span class="s2">), </span><span class="s1">direction</span><span class="s2">, </span><span class="s1">d</span><span class="s2">);</span>
						<span class="s1">Box box4 </span><span class="s2">= </span><span class="s1">entity</span><span class="s2">.</span><span class="s1">getBoundingBox</span><span class="s2">();</span>
						<span class="s0">if </span><span class="s2">(</span><span class="s1">box3</span><span class="s2">.</span><span class="s1">intersects</span><span class="s2">(</span><span class="s1">box4</span><span class="s2">)) {</span>
							<span class="s1">i </span><span class="s2">= </span><span class="s1">Math</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">i</span><span class="s2">, </span><span class="s1">getIntersectionSize</span><span class="s2">(</span><span class="s1">box3</span><span class="s2">, </span><span class="s1">direction</span><span class="s2">, </span><span class="s1">box4</span><span class="s2">));</span>
							<span class="s0">if </span><span class="s2">(</span><span class="s1">i </span><span class="s2">&gt;= </span><span class="s1">d</span><span class="s2">) {</span>
								<span class="s0">break</span><span class="s2">;</span>
							<span class="s2">}</span>
						<span class="s2">}</span>
					<span class="s2">}</span>

					<span class="s0">if </span><span class="s2">(!(</span><span class="s1">i </span><span class="s2">&lt;= </span><span class="s4">0.0</span><span class="s2">)) {</span>
						<span class="s1">i </span><span class="s2">= </span><span class="s1">Math</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(</span><span class="s1">i</span><span class="s2">, </span><span class="s1">d</span><span class="s2">) + </span><span class="s4">0.01</span><span class="s2">;</span>
						<span class="s1">moveEntity</span><span class="s2">(</span><span class="s1">direction</span><span class="s2">, </span><span class="s1">entity</span><span class="s2">, </span><span class="s1">i</span><span class="s2">, </span><span class="s1">direction</span><span class="s2">);</span>
						<span class="s0">if </span><span class="s2">(!</span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">extending </span><span class="s2">&amp;&amp; </span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">source</span><span class="s2">) {</span>
							<span class="s1">push</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">, </span><span class="s1">entity</span><span class="s2">, </span><span class="s1">direction</span><span class="s2">, </span><span class="s1">d</span><span class="s2">);</span>
						<span class="s2">}</span>
					<span class="s2">}</span>
				<span class="s2">}</span>
			<span class="s2">}</span>
		<span class="s2">}</span>
	<span class="s2">}</span>

	<span class="s0">private static void </span><span class="s1">moveEntity</span><span class="s2">(</span><span class="s1">Direction direction</span><span class="s2">, </span><span class="s1">Entity entity</span><span class="s2">, </span><span class="s0">double </span><span class="s1">distance</span><span class="s2">, </span><span class="s1">Direction movementDirection</span><span class="s2">) {</span>
		<span class="s1">entityMovementDirection</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">direction</span><span class="s2">);</span>
		<span class="s1">entity</span><span class="s2">.</span><span class="s1">move</span><span class="s2">(</span><span class="s1">MovementType</span><span class="s2">.</span><span class="s1">PISTON</span><span class="s2">, </span><span class="s0">new </span><span class="s1">Vec3d</span><span class="s2">(</span><span class="s1">distance </span><span class="s2">* (</span><span class="s0">double</span><span class="s2">)</span><span class="s1">movementDirection</span><span class="s2">.</span><span class="s1">getOffsetX</span><span class="s2">(), </span><span class="s1">distance </span><span class="s2">* (</span><span class="s0">double</span><span class="s2">)</span><span class="s1">movementDirection</span><span class="s2">.</span><span class="s1">getOffsetY</span><span class="s2">(), </span><span class="s1">distance </span><span class="s2">* (</span><span class="s0">double</span><span class="s2">)</span><span class="s1">movementDirection</span><span class="s2">.</span><span class="s1">getOffsetZ</span><span class="s2">()));</span>
		<span class="s1">entityMovementDirection</span><span class="s2">.</span><span class="s1">set</span><span class="s2">((</span><span class="s1">Object</span><span class="s2">)</span><span class="s0">null</span><span class="s2">);</span>
	<span class="s2">}</span>

	<span class="s0">private static void </span><span class="s1">moveEntitiesInHoneyBlock</span><span class="s2">(</span><span class="s1">World world</span><span class="s2">, </span><span class="s1">BlockPos pos</span><span class="s2">, </span><span class="s0">float </span><span class="s1">f</span><span class="s2">, </span><span class="s1">PistonBlockEntity blockEntity</span><span class="s2">) {</span>
		<span class="s0">if </span><span class="s2">(</span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">isPushingHoneyBlock</span><span class="s2">()) {</span>
			<span class="s1">Direction direction </span><span class="s2">= </span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">getMovementDirection</span><span class="s2">();</span>
			<span class="s0">if </span><span class="s2">(</span><span class="s1">direction</span><span class="s2">.</span><span class="s1">getAxis</span><span class="s2">().</span><span class="s1">isHorizontal</span><span class="s2">()) {</span>
				<span class="s0">double </span><span class="s1">d </span><span class="s2">= </span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">pushedBlock</span><span class="s2">.</span><span class="s1">getCollisionShape</span><span class="s2">(</span><span class="s1">world</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">).</span><span class="s1">getMax</span><span class="s2">(</span><span class="s1">Direction</span><span class="s2">.</span><span class="s1">Axis</span><span class="s2">.</span><span class="s1">Y</span><span class="s2">);</span>
				<span class="s1">Box box </span><span class="s2">= </span><span class="s1">offsetHeadBox</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">, </span><span class="s0">new </span><span class="s1">Box</span><span class="s2">(</span><span class="s4">0.0</span><span class="s2">, </span><span class="s1">d</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">1.5000010000000001</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">), </span><span class="s1">blockEntity</span><span class="s2">);</span>
				<span class="s0">double </span><span class="s1">e </span><span class="s2">= (</span><span class="s0">double</span><span class="s2">)(</span><span class="s1">f </span><span class="s2">- </span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">progress</span><span class="s2">);</span>
				<span class="s1">List</span><span class="s2">&lt;</span><span class="s1">Entity</span><span class="s2">&gt; </span><span class="s1">list </span><span class="s2">= </span><span class="s1">world</span><span class="s2">.</span><span class="s1">getOtherEntities</span><span class="s2">((</span><span class="s1">Entity</span><span class="s2">)</span><span class="s0">null</span><span class="s2">, </span><span class="s1">box</span><span class="s2">, (</span><span class="s1">entityx</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s2">{</span>
					<span class="s0">return </span><span class="s1">canMoveEntity</span><span class="s2">(</span><span class="s1">box</span><span class="s2">, </span><span class="s1">entityx</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">);</span>
				<span class="s2">});</span>
				<span class="s1">Iterator var11 </span><span class="s2">= </span><span class="s1">list</span><span class="s2">.</span><span class="s1">iterator</span><span class="s2">();</span>

				<span class="s0">while</span><span class="s2">(</span><span class="s1">var11</span><span class="s2">.</span><span class="s1">hasNext</span><span class="s2">()) {</span>
					<span class="s1">Entity entity </span><span class="s2">= (</span><span class="s1">Entity</span><span class="s2">)</span><span class="s1">var11</span><span class="s2">.</span><span class="s1">next</span><span class="s2">();</span>
					<span class="s1">moveEntity</span><span class="s2">(</span><span class="s1">direction</span><span class="s2">, </span><span class="s1">entity</span><span class="s2">, </span><span class="s1">e</span><span class="s2">, </span><span class="s1">direction</span><span class="s2">);</span>
				<span class="s2">}</span>

			<span class="s2">}</span>
		<span class="s2">}</span>
	<span class="s2">}</span>

	<span class="s0">private static boolean </span><span class="s1">canMoveEntity</span><span class="s2">(</span><span class="s1">Box box</span><span class="s2">, </span><span class="s1">Entity entity</span><span class="s2">, </span><span class="s1">BlockPos pos</span><span class="s2">) {</span>
		<span class="s0">return </span><span class="s1">entity</span><span class="s2">.</span><span class="s1">getPistonBehavior</span><span class="s2">() == </span><span class="s1">PistonBehavior</span><span class="s2">.</span><span class="s1">NORMAL </span><span class="s2">&amp;&amp; </span><span class="s1">entity</span><span class="s2">.</span><span class="s1">isOnGround</span><span class="s2">() &amp;&amp; (</span><span class="s1">entity</span><span class="s2">.</span><span class="s1">isSupportedBy</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">) || </span><span class="s1">entity</span><span class="s2">.</span><span class="s1">getX</span><span class="s2">() &gt;= </span><span class="s1">box</span><span class="s2">.</span><span class="s1">minX </span><span class="s2">&amp;&amp; </span><span class="s1">entity</span><span class="s2">.</span><span class="s1">getX</span><span class="s2">() &lt;= </span><span class="s1">box</span><span class="s2">.</span><span class="s1">maxX </span><span class="s2">&amp;&amp; </span><span class="s1">entity</span><span class="s2">.</span><span class="s1">getZ</span><span class="s2">() &gt;= </span><span class="s1">box</span><span class="s2">.</span><span class="s1">minZ </span><span class="s2">&amp;&amp; </span><span class="s1">entity</span><span class="s2">.</span><span class="s1">getZ</span><span class="s2">() &lt;= </span><span class="s1">box</span><span class="s2">.</span><span class="s1">maxZ</span><span class="s2">);</span>
	<span class="s2">}</span>

	<span class="s0">private boolean </span><span class="s1">isPushingHoneyBlock</span><span class="s2">() {</span>
		<span class="s0">return this</span><span class="s2">.</span><span class="s1">pushedBlock</span><span class="s2">.</span><span class="s1">isOf</span><span class="s2">(</span><span class="s1">Blocks</span><span class="s2">.</span><span class="s1">HONEY_BLOCK</span><span class="s2">);</span>
	<span class="s2">}</span>

	<span class="s0">public </span><span class="s1">Direction getMovementDirection</span><span class="s2">() {</span>
		<span class="s0">return this</span><span class="s2">.</span><span class="s1">extending </span><span class="s2">? </span><span class="s0">this</span><span class="s2">.</span><span class="s1">facing </span><span class="s2">: </span><span class="s0">this</span><span class="s2">.</span><span class="s1">facing</span><span class="s2">.</span><span class="s1">getOpposite</span><span class="s2">();</span>
	<span class="s2">}</span>

	<span class="s0">private static double </span><span class="s1">getIntersectionSize</span><span class="s2">(</span><span class="s1">Box box</span><span class="s2">, </span><span class="s1">Direction direction</span><span class="s2">, </span><span class="s1">Box box2</span><span class="s2">) {</span>
		<span class="s0">switch </span><span class="s2">(</span><span class="s1">direction</span><span class="s2">) {</span>
			<span class="s0">case </span><span class="s1">EAST</span><span class="s2">:</span>
				<span class="s0">return </span><span class="s1">box</span><span class="s2">.</span><span class="s1">maxX </span><span class="s2">- </span><span class="s1">box2</span><span class="s2">.</span><span class="s1">minX</span><span class="s2">;</span>
			<span class="s0">case </span><span class="s1">WEST</span><span class="s2">:</span>
				<span class="s0">return </span><span class="s1">box2</span><span class="s2">.</span><span class="s1">maxX </span><span class="s2">- </span><span class="s1">box</span><span class="s2">.</span><span class="s1">minX</span><span class="s2">;</span>
			<span class="s0">case </span><span class="s1">UP</span><span class="s2">:</span>
			<span class="s0">default</span><span class="s2">:</span>
				<span class="s0">return </span><span class="s1">box</span><span class="s2">.</span><span class="s1">maxY </span><span class="s2">- </span><span class="s1">box2</span><span class="s2">.</span><span class="s1">minY</span><span class="s2">;</span>
			<span class="s0">case </span><span class="s1">DOWN</span><span class="s2">:</span>
				<span class="s0">return </span><span class="s1">box2</span><span class="s2">.</span><span class="s1">maxY </span><span class="s2">- </span><span class="s1">box</span><span class="s2">.</span><span class="s1">minY</span><span class="s2">;</span>
			<span class="s0">case </span><span class="s1">SOUTH</span><span class="s2">:</span>
				<span class="s0">return </span><span class="s1">box</span><span class="s2">.</span><span class="s1">maxZ </span><span class="s2">- </span><span class="s1">box2</span><span class="s2">.</span><span class="s1">minZ</span><span class="s2">;</span>
			<span class="s0">case </span><span class="s1">NORTH</span><span class="s2">:</span>
				<span class="s0">return </span><span class="s1">box2</span><span class="s2">.</span><span class="s1">maxZ </span><span class="s2">- </span><span class="s1">box</span><span class="s2">.</span><span class="s1">minZ</span><span class="s2">;</span>
		<span class="s2">}</span>
	<span class="s2">}</span>

	<span class="s0">private static </span><span class="s1">Box offsetHeadBox</span><span class="s2">(</span><span class="s1">BlockPos pos</span><span class="s2">, </span><span class="s1">Box box</span><span class="s2">, </span><span class="s1">PistonBlockEntity blockEntity</span><span class="s2">) {</span>
		<span class="s0">double </span><span class="s1">d </span><span class="s2">= (</span><span class="s0">double</span><span class="s2">)</span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">getAmountExtended</span><span class="s2">(</span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">progress</span><span class="s2">);</span>
		<span class="s0">return </span><span class="s1">box</span><span class="s2">.</span><span class="s1">offset</span><span class="s2">((</span><span class="s0">double</span><span class="s2">)</span><span class="s1">pos</span><span class="s2">.</span><span class="s1">getX</span><span class="s2">() + </span><span class="s1">d </span><span class="s2">* (</span><span class="s0">double</span><span class="s2">)</span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">facing</span><span class="s2">.</span><span class="s1">getOffsetX</span><span class="s2">(), (</span><span class="s0">double</span><span class="s2">)</span><span class="s1">pos</span><span class="s2">.</span><span class="s1">getY</span><span class="s2">() + </span><span class="s1">d </span><span class="s2">* (</span><span class="s0">double</span><span class="s2">)</span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">facing</span><span class="s2">.</span><span class="s1">getOffsetY</span><span class="s2">(), (</span><span class="s0">double</span><span class="s2">)</span><span class="s1">pos</span><span class="s2">.</span><span class="s1">getZ</span><span class="s2">() + </span><span class="s1">d </span><span class="s2">* (</span><span class="s0">double</span><span class="s2">)</span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">facing</span><span class="s2">.</span><span class="s1">getOffsetZ</span><span class="s2">());</span>
	<span class="s2">}</span>

	<span class="s0">private static void </span><span class="s1">push</span><span class="s2">(</span><span class="s1">BlockPos pos</span><span class="s2">, </span><span class="s1">Entity entity</span><span class="s2">, </span><span class="s1">Direction direction</span><span class="s2">, </span><span class="s0">double </span><span class="s1">amount</span><span class="s2">) {</span>
		<span class="s1">Box box </span><span class="s2">= </span><span class="s1">entity</span><span class="s2">.</span><span class="s1">getBoundingBox</span><span class="s2">();</span>
		<span class="s1">Box box2 </span><span class="s2">= </span><span class="s1">VoxelShapes</span><span class="s2">.</span><span class="s1">fullCube</span><span class="s2">().</span><span class="s1">getBoundingBox</span><span class="s2">().</span><span class="s1">offset</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">);</span>
		<span class="s0">if </span><span class="s2">(</span><span class="s1">box</span><span class="s2">.</span><span class="s1">intersects</span><span class="s2">(</span><span class="s1">box2</span><span class="s2">)) {</span>
			<span class="s1">Direction direction2 </span><span class="s2">= </span><span class="s1">direction</span><span class="s2">.</span><span class="s1">getOpposite</span><span class="s2">();</span>
			<span class="s0">double </span><span class="s1">d </span><span class="s2">= </span><span class="s1">getIntersectionSize</span><span class="s2">(</span><span class="s1">box2</span><span class="s2">, </span><span class="s1">direction2</span><span class="s2">, </span><span class="s1">box</span><span class="s2">) + </span><span class="s4">0.01</span><span class="s2">;</span>
			<span class="s0">double </span><span class="s1">e </span><span class="s2">= </span><span class="s1">getIntersectionSize</span><span class="s2">(</span><span class="s1">box2</span><span class="s2">, </span><span class="s1">direction2</span><span class="s2">, </span><span class="s1">box</span><span class="s2">.</span><span class="s1">intersection</span><span class="s2">(</span><span class="s1">box2</span><span class="s2">)) + </span><span class="s4">0.01</span><span class="s2">;</span>
			<span class="s0">if </span><span class="s2">(</span><span class="s1">Math</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">d </span><span class="s2">- </span><span class="s1">e</span><span class="s2">) &lt; </span><span class="s4">0.01</span><span class="s2">) {</span>
				<span class="s1">d </span><span class="s2">= </span><span class="s1">Math</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(</span><span class="s1">d</span><span class="s2">, </span><span class="s1">amount</span><span class="s2">) + </span><span class="s4">0.01</span><span class="s2">;</span>
				<span class="s1">moveEntity</span><span class="s2">(</span><span class="s1">direction</span><span class="s2">, </span><span class="s1">entity</span><span class="s2">, </span><span class="s1">d</span><span class="s2">, </span><span class="s1">direction2</span><span class="s2">);</span>
			<span class="s2">}</span>
		<span class="s2">}</span>

	<span class="s2">}</span>

	<span class="s0">public </span><span class="s1">BlockState getPushedBlock</span><span class="s2">() {</span>
		<span class="s0">return this</span><span class="s2">.</span><span class="s1">pushedBlock</span><span class="s2">;</span>
	<span class="s2">}</span>

	<span class="s0">public void </span><span class="s1">finish</span><span class="s2">() {</span>
		<span class="s0">if </span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">world </span><span class="s2">!= </span><span class="s0">null </span><span class="s2">&amp;&amp; (</span><span class="s0">this</span><span class="s2">.</span><span class="s1">lastProgress </span><span class="s2">&lt; </span><span class="s4">1.0F </span><span class="s2">|| </span><span class="s0">this</span><span class="s2">.</span><span class="s1">world</span><span class="s2">.</span><span class="s1">isClient</span><span class="s2">)) {</span>
			<span class="s0">this</span><span class="s2">.</span><span class="s1">progress </span><span class="s2">= </span><span class="s4">1.0F</span><span class="s2">;</span>
			<span class="s0">this</span><span class="s2">.</span><span class="s1">lastProgress </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">progress</span><span class="s2">;</span>
			<span class="s0">this</span><span class="s2">.</span><span class="s1">world</span><span class="s2">.</span><span class="s1">removeBlockEntity</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">pos</span><span class="s2">);</span>
			<span class="s0">this</span><span class="s2">.</span><span class="s1">markRemoved</span><span class="s2">();</span>
			<span class="s0">if </span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">world</span><span class="s2">.</span><span class="s1">getBlockState</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">pos</span><span class="s2">).</span><span class="s1">isOf</span><span class="s2">(</span><span class="s1">Blocks</span><span class="s2">.</span><span class="s1">MOVING_PISTON</span><span class="s2">)) {</span>
				<span class="s1">BlockState blockState</span><span class="s2">;</span>
				<span class="s0">if </span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">source</span><span class="s2">) {</span>
					<span class="s1">blockState </span><span class="s2">= </span><span class="s1">Blocks</span><span class="s2">.</span><span class="s1">AIR</span><span class="s2">.</span><span class="s1">getDefaultState</span><span class="s2">();</span>
				<span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
					<span class="s1">blockState </span><span class="s2">= </span><span class="s1">Block</span><span class="s2">.</span><span class="s1">postProcessState</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">pushedBlock</span><span class="s2">, </span><span class="s0">this</span><span class="s2">.</span><span class="s1">world</span><span class="s2">, </span><span class="s0">this</span><span class="s2">.</span><span class="s1">pos</span><span class="s2">);</span>
				<span class="s2">}</span>

				<span class="s0">this</span><span class="s2">.</span><span class="s1">world</span><span class="s2">.</span><span class="s1">setBlockState</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">pos</span><span class="s2">, </span><span class="s1">blockState</span><span class="s2">, </span><span class="s1">Block</span><span class="s2">.</span><span class="s1">NOTIFY_ALL</span><span class="s2">);</span>
				<span class="s0">this</span><span class="s2">.</span><span class="s1">world</span><span class="s2">.</span><span class="s1">updateNeighbor</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">pos</span><span class="s2">, </span><span class="s1">blockState</span><span class="s2">.</span><span class="s1">getBlock</span><span class="s2">(), </span><span class="s0">this</span><span class="s2">.</span><span class="s1">pos</span><span class="s2">);</span>
			<span class="s2">}</span>
		<span class="s2">}</span>

	<span class="s2">}</span>

	<span class="s0">public static void </span><span class="s1">tick</span><span class="s2">(</span><span class="s1">World world</span><span class="s2">, </span><span class="s1">BlockPos pos</span><span class="s2">, </span><span class="s1">BlockState state</span><span class="s2">, </span><span class="s1">PistonBlockEntity blockEntity</span><span class="s2">) {</span>
		<span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">savedWorldTime </span><span class="s2">= </span><span class="s1">world</span><span class="s2">.</span><span class="s1">getTime</span><span class="s2">();</span>
		<span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">lastProgress </span><span class="s2">= </span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">progress</span><span class="s2">;</span>
		<span class="s0">if </span><span class="s2">(</span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">lastProgress </span><span class="s2">&gt;= </span><span class="s4">1.0F</span><span class="s2">) {</span>
			<span class="s0">if </span><span class="s2">(</span><span class="s1">world</span><span class="s2">.</span><span class="s1">isClient </span><span class="s2">&amp;&amp; </span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">field_26705 </span><span class="s2">&lt; </span><span class="s4">5</span><span class="s2">) {</span>
				<span class="s2">++</span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">field_26705</span><span class="s2">;</span>
			<span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
				<span class="s1">world</span><span class="s2">.</span><span class="s1">removeBlockEntity</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">);</span>
				<span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">markRemoved</span><span class="s2">();</span>
				<span class="s0">if </span><span class="s2">(</span><span class="s1">world</span><span class="s2">.</span><span class="s1">getBlockState</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">).</span><span class="s1">isOf</span><span class="s2">(</span><span class="s1">Blocks</span><span class="s2">.</span><span class="s1">MOVING_PISTON</span><span class="s2">)) {</span>
					<span class="s1">BlockState blockState </span><span class="s2">= </span><span class="s1">Block</span><span class="s2">.</span><span class="s1">postProcessState</span><span class="s2">(</span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">pushedBlock</span><span class="s2">, </span><span class="s1">world</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">);</span>
					<span class="s0">if </span><span class="s2">(</span><span class="s1">blockState</span><span class="s2">.</span><span class="s1">isAir</span><span class="s2">()) {</span>
						<span class="s1">world</span><span class="s2">.</span><span class="s1">setBlockState</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">, </span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">pushedBlock</span><span class="s2">, </span><span class="s1">Block</span><span class="s2">.</span><span class="s1">NO_REDRAW </span><span class="s2">| </span><span class="s1">Block</span><span class="s2">.</span><span class="s1">FORCE_STATE </span><span class="s2">| </span><span class="s1">Block</span><span class="s2">.</span><span class="s1">MOVED</span><span class="s2">);</span>
						<span class="s1">Block</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">pushedBlock</span><span class="s2">, </span><span class="s1">blockState</span><span class="s2">, </span><span class="s1">world</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">Block</span><span class="s2">.</span><span class="s1">NOTIFY_ALL</span><span class="s2">);</span>
					<span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
						<span class="s0">if </span><span class="s2">(</span><span class="s1">blockState</span><span class="s2">.</span><span class="s1">contains</span><span class="s2">(</span><span class="s1">Properties</span><span class="s2">.</span><span class="s1">WATERLOGGED</span><span class="s2">) &amp;&amp; (</span><span class="s1">Boolean</span><span class="s2">)</span><span class="s1">blockState</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">Properties</span><span class="s2">.</span><span class="s1">WATERLOGGED</span><span class="s2">)) {</span>
							<span class="s1">blockState </span><span class="s2">= (</span><span class="s1">BlockState</span><span class="s2">)</span><span class="s1">blockState</span><span class="s2">.</span><span class="s1">with</span><span class="s2">(</span><span class="s1">Properties</span><span class="s2">.</span><span class="s1">WATERLOGGED</span><span class="s2">, </span><span class="s0">false</span><span class="s2">);</span>
						<span class="s2">}</span>

						<span class="s1">world</span><span class="s2">.</span><span class="s1">setBlockState</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">, </span><span class="s1">blockState</span><span class="s2">, </span><span class="s1">Block</span><span class="s2">.</span><span class="s1">NOTIFY_ALL </span><span class="s2">| </span><span class="s1">Block</span><span class="s2">.</span><span class="s1">MOVED</span><span class="s2">);</span>
						<span class="s1">world</span><span class="s2">.</span><span class="s1">updateNeighbor</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">, </span><span class="s1">blockState</span><span class="s2">.</span><span class="s1">getBlock</span><span class="s2">(), </span><span class="s1">pos</span><span class="s2">);</span>
					<span class="s2">}</span>
				<span class="s2">}</span>

			<span class="s2">}</span>
		<span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
			<span class="s0">float </span><span class="s1">f </span><span class="s2">= </span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">progress </span><span class="s2">+ </span><span class="s4">0.5F</span><span class="s2">;</span>
			<span class="s1">pushEntities</span><span class="s2">(</span><span class="s1">world</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">blockEntity</span><span class="s2">);</span>
			<span class="s1">moveEntitiesInHoneyBlock</span><span class="s2">(</span><span class="s1">world</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">blockEntity</span><span class="s2">);</span>
			<span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">progress </span><span class="s2">= </span><span class="s1">f</span><span class="s2">;</span>
			<span class="s0">if </span><span class="s2">(</span><span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">progress </span><span class="s2">&gt;= </span><span class="s4">1.0F</span><span class="s2">) {</span>
				<span class="s1">blockEntity</span><span class="s2">.</span><span class="s1">progress </span><span class="s2">= </span><span class="s4">1.0F</span><span class="s2">;</span>
			<span class="s2">}</span>

		<span class="s2">}</span>
	<span class="s2">}</span>

	<span class="s0">public void </span><span class="s1">readNbt</span><span class="s2">(</span><span class="s1">NbtCompound nbt</span><span class="s2">) {</span>
		<span class="s0">super</span><span class="s2">.</span><span class="s1">readNbt</span><span class="s2">(</span><span class="s1">nbt</span><span class="s2">);</span>
		<span class="s1">RegistryEntryLookup</span><span class="s2">&lt;</span><span class="s1">Block</span><span class="s2">&gt; </span><span class="s1">registryEntryLookup </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">world </span><span class="s2">!= </span><span class="s0">null </span><span class="s2">? </span><span class="s0">this</span><span class="s2">.</span><span class="s1">world</span><span class="s2">.</span><span class="s1">createCommandRegistryWrapper</span><span class="s2">(</span><span class="s1">RegistryKeys</span><span class="s2">.</span><span class="s1">BLOCK</span><span class="s2">) : </span><span class="s1">Registries</span><span class="s2">.</span><span class="s1">BLOCK</span><span class="s2">.</span><span class="s1">getReadOnlyWrapper</span><span class="s2">();</span>
		<span class="s0">this</span><span class="s2">.</span><span class="s1">pushedBlock </span><span class="s2">= </span><span class="s1">NbtHelper</span><span class="s2">.</span><span class="s1">toBlockState</span><span class="s2">((</span><span class="s1">RegistryEntryLookup</span><span class="s2">)</span><span class="s1">registryEntryLookup</span><span class="s2">, </span><span class="s1">nbt</span><span class="s2">.</span><span class="s1">getCompound</span><span class="s2">(</span><span class="s5">&quot;blockState&quot;</span><span class="s2">));</span>
		<span class="s0">this</span><span class="s2">.</span><span class="s1">facing </span><span class="s2">= </span><span class="s1">Direction</span><span class="s2">.</span><span class="s1">byId</span><span class="s2">(</span><span class="s1">nbt</span><span class="s2">.</span><span class="s1">getInt</span><span class="s2">(</span><span class="s5">&quot;facing&quot;</span><span class="s2">));</span>
		<span class="s0">this</span><span class="s2">.</span><span class="s1">progress </span><span class="s2">= </span><span class="s1">nbt</span><span class="s2">.</span><span class="s1">getFloat</span><span class="s2">(</span><span class="s5">&quot;progress&quot;</span><span class="s2">);</span>
		<span class="s0">this</span><span class="s2">.</span><span class="s1">lastProgress </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">progress</span><span class="s2">;</span>
		<span class="s0">this</span><span class="s2">.</span><span class="s1">extending </span><span class="s2">= </span><span class="s1">nbt</span><span class="s2">.</span><span class="s1">getBoolean</span><span class="s2">(</span><span class="s5">&quot;extending&quot;</span><span class="s2">);</span>
		<span class="s0">this</span><span class="s2">.</span><span class="s1">source </span><span class="s2">= </span><span class="s1">nbt</span><span class="s2">.</span><span class="s1">getBoolean</span><span class="s2">(</span><span class="s5">&quot;source&quot;</span><span class="s2">);</span>
	<span class="s2">}</span>

	<span class="s0">protected void </span><span class="s1">writeNbt</span><span class="s2">(</span><span class="s1">NbtCompound nbt</span><span class="s2">) {</span>
		<span class="s0">super</span><span class="s2">.</span><span class="s1">writeNbt</span><span class="s2">(</span><span class="s1">nbt</span><span class="s2">);</span>
		<span class="s1">nbt</span><span class="s2">.</span><span class="s1">put</span><span class="s2">(</span><span class="s5">&quot;blockState&quot;</span><span class="s2">, </span><span class="s1">NbtHelper</span><span class="s2">.</span><span class="s1">fromBlockState</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">pushedBlock</span><span class="s2">));</span>
		<span class="s1">nbt</span><span class="s2">.</span><span class="s1">putInt</span><span class="s2">(</span><span class="s5">&quot;facing&quot;</span><span class="s2">, </span><span class="s0">this</span><span class="s2">.</span><span class="s1">facing</span><span class="s2">.</span><span class="s1">getId</span><span class="s2">());</span>
		<span class="s1">nbt</span><span class="s2">.</span><span class="s1">putFloat</span><span class="s2">(</span><span class="s5">&quot;progress&quot;</span><span class="s2">, </span><span class="s0">this</span><span class="s2">.</span><span class="s1">lastProgress</span><span class="s2">);</span>
		<span class="s1">nbt</span><span class="s2">.</span><span class="s1">putBoolean</span><span class="s2">(</span><span class="s5">&quot;extending&quot;</span><span class="s2">, </span><span class="s0">this</span><span class="s2">.</span><span class="s1">extending</span><span class="s2">);</span>
		<span class="s1">nbt</span><span class="s2">.</span><span class="s1">putBoolean</span><span class="s2">(</span><span class="s5">&quot;source&quot;</span><span class="s2">, </span><span class="s0">this</span><span class="s2">.</span><span class="s1">source</span><span class="s2">);</span>
	<span class="s2">}</span>

	<span class="s0">public </span><span class="s1">VoxelShape getCollisionShape</span><span class="s2">(</span><span class="s1">BlockView world</span><span class="s2">, </span><span class="s1">BlockPos pos</span><span class="s2">) {</span>
		<span class="s1">VoxelShape voxelShape</span><span class="s2">;</span>
		<span class="s0">if </span><span class="s2">(!</span><span class="s0">this</span><span class="s2">.</span><span class="s1">extending </span><span class="s2">&amp;&amp; </span><span class="s0">this</span><span class="s2">.</span><span class="s1">source </span><span class="s2">&amp;&amp; </span><span class="s0">this</span><span class="s2">.</span><span class="s1">pushedBlock</span><span class="s2">.</span><span class="s1">getBlock</span><span class="s2">() </span><span class="s0">instanceof </span><span class="s1">PistonBlock</span><span class="s2">) {</span>
			<span class="s1">voxelShape </span><span class="s2">= ((</span><span class="s1">BlockState</span><span class="s2">)</span><span class="s0">this</span><span class="s2">.</span><span class="s1">pushedBlock</span><span class="s2">.</span><span class="s1">with</span><span class="s2">(</span><span class="s1">PistonBlock</span><span class="s2">.</span><span class="s1">EXTENDED</span><span class="s2">, </span><span class="s0">true</span><span class="s2">)).</span><span class="s1">getCollisionShape</span><span class="s2">(</span><span class="s1">world</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">);</span>
		<span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
			<span class="s1">voxelShape </span><span class="s2">= </span><span class="s1">VoxelShapes</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">();</span>
		<span class="s2">}</span>

		<span class="s1">Direction direction </span><span class="s2">= (</span><span class="s1">Direction</span><span class="s2">)</span><span class="s1">entityMovementDirection</span><span class="s2">.</span><span class="s1">get</span><span class="s2">();</span>
		<span class="s0">if </span><span class="s2">((</span><span class="s0">double</span><span class="s2">)</span><span class="s0">this</span><span class="s2">.</span><span class="s1">progress </span><span class="s2">&lt; </span><span class="s4">1.0 </span><span class="s2">&amp;&amp; </span><span class="s1">direction </span><span class="s2">== </span><span class="s0">this</span><span class="s2">.</span><span class="s1">getMovementDirection</span><span class="s2">()) {</span>
			<span class="s0">return </span><span class="s1">voxelShape</span><span class="s2">;</span>
		<span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
			<span class="s1">BlockState blockState</span><span class="s2">;</span>
			<span class="s0">if </span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">isSource</span><span class="s2">()) {</span>
				<span class="s1">blockState </span><span class="s2">= (</span><span class="s1">BlockState</span><span class="s2">)((</span><span class="s1">BlockState</span><span class="s2">)</span><span class="s1">Blocks</span><span class="s2">.</span><span class="s1">PISTON_HEAD</span><span class="s2">.</span><span class="s1">getDefaultState</span><span class="s2">().</span><span class="s1">with</span><span class="s2">(</span><span class="s1">PistonHeadBlock</span><span class="s2">.</span><span class="s1">FACING</span><span class="s2">, </span><span class="s0">this</span><span class="s2">.</span><span class="s1">facing</span><span class="s2">)).</span><span class="s1">with</span><span class="s2">(</span><span class="s1">PistonHeadBlock</span><span class="s2">.</span><span class="s1">SHORT</span><span class="s2">, </span><span class="s0">this</span><span class="s2">.</span><span class="s1">extending </span><span class="s2">!= </span><span class="s4">1.0F </span><span class="s2">- </span><span class="s0">this</span><span class="s2">.</span><span class="s1">progress </span><span class="s2">&lt; </span><span class="s4">0.25F</span><span class="s2">);</span>
			<span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
				<span class="s1">blockState </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">pushedBlock</span><span class="s2">;</span>
			<span class="s2">}</span>

			<span class="s0">float </span><span class="s1">f </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">getAmountExtended</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">progress</span><span class="s2">);</span>
			<span class="s0">double </span><span class="s1">d </span><span class="s2">= (</span><span class="s0">double</span><span class="s2">)((</span><span class="s0">float</span><span class="s2">)</span><span class="s0">this</span><span class="s2">.</span><span class="s1">facing</span><span class="s2">.</span><span class="s1">getOffsetX</span><span class="s2">() * </span><span class="s1">f</span><span class="s2">);</span>
			<span class="s0">double </span><span class="s1">e </span><span class="s2">= (</span><span class="s0">double</span><span class="s2">)((</span><span class="s0">float</span><span class="s2">)</span><span class="s0">this</span><span class="s2">.</span><span class="s1">facing</span><span class="s2">.</span><span class="s1">getOffsetY</span><span class="s2">() * </span><span class="s1">f</span><span class="s2">);</span>
			<span class="s0">double </span><span class="s1">g </span><span class="s2">= (</span><span class="s0">double</span><span class="s2">)((</span><span class="s0">float</span><span class="s2">)</span><span class="s0">this</span><span class="s2">.</span><span class="s1">facing</span><span class="s2">.</span><span class="s1">getOffsetZ</span><span class="s2">() * </span><span class="s1">f</span><span class="s2">);</span>
			<span class="s0">return </span><span class="s1">VoxelShapes</span><span class="s2">.</span><span class="s1">union</span><span class="s2">(</span><span class="s1">voxelShape</span><span class="s2">, </span><span class="s1">blockState</span><span class="s2">.</span><span class="s1">getCollisionShape</span><span class="s2">(</span><span class="s1">world</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">).</span><span class="s1">offset</span><span class="s2">(</span><span class="s1">d</span><span class="s2">, </span><span class="s1">e</span><span class="s2">, </span><span class="s1">g</span><span class="s2">));</span>
		<span class="s2">}</span>
	<span class="s2">}</span>

	<span class="s0">public long </span><span class="s1">getSavedWorldTime</span><span class="s2">() {</span>
		<span class="s0">return this</span><span class="s2">.</span><span class="s1">savedWorldTime</span><span class="s2">;</span>
	<span class="s2">}</span>

	<span class="s0">public void </span><span class="s1">setWorld</span><span class="s2">(</span><span class="s1">World world</span><span class="s2">) {</span>
		<span class="s0">super</span><span class="s2">.</span><span class="s1">setWorld</span><span class="s2">(</span><span class="s1">world</span><span class="s2">);</span>
		<span class="s0">if </span><span class="s2">(</span><span class="s1">world</span><span class="s2">.</span><span class="s1">createCommandRegistryWrapper</span><span class="s2">(</span><span class="s1">RegistryKeys</span><span class="s2">.</span><span class="s1">BLOCK</span><span class="s2">).</span><span class="s1">getOptional</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">pushedBlock</span><span class="s2">.</span><span class="s1">getBlock</span><span class="s2">().</span><span class="s1">getRegistryEntry</span><span class="s2">().</span><span class="s1">registryKey</span><span class="s2">()).</span><span class="s1">isEmpty</span><span class="s2">()) {</span>
			<span class="s0">this</span><span class="s2">.</span><span class="s1">pushedBlock </span><span class="s2">= </span><span class="s1">Blocks</span><span class="s2">.</span><span class="s1">AIR</span><span class="s2">.</span><span class="s1">getDefaultState</span><span class="s2">();</span>
		<span class="s2">}</span>

	<span class="s2">}</span>
<span class="s2">}</span>
</pre>
</body>
</html>